<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Prices | KISAN-DRISHTI</title>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="../css/style.css" rel="stylesheet" />
  <script src="../js/main.js"></script>
  <script src="../js/language-selector.js"></script>
  <script src="../js/voice-interaction.js"></script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen pb-24 text-slate-900 dark:text-slate-100">
  <nav class="kd-glass sticky top-0 z-50 border-b border-slate-200/60 dark:border-slate-700/60 px-4 py-3">
    <div class="max-w-4xl mx-auto flex items-center justify-between flex-wrap gap-2">
      <a href="../index.html" class="flex items-center gap-3 text-slate-800 dark:text-white hover:text-primary kd-transition min-h-[44px] items-center">
        <img src="../images/spit%20logo.png" alt="KISAN-DRISHTI" class="h-10 w-10 object-contain flex-shrink-0 rounded-xl" onerror="this.style.display='none'; var n=this.nextElementSibling; if(n) n.classList.remove('hidden');" />
        <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white shadow-md shadow-primary/20 flex-shrink-0 hidden"><span class="material-icons">eco</span></div>
        <span class="text-lg font-bold">KISAN-DRISHTI</span>
      </a>
      <div class="flex items-center gap-2 flex-wrap">
        <a href="dashboard.html" class="nav-pill px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-zinc-800 text-sm transition-colors" data-translate="nav.dashboard">Dashboard</a>
        <a href="market-prices.html" class="nav-pill px-4 py-2 rounded-xl bg-primary/10 text-primary font-semibold text-sm" data-translate="nav.prices">Prices</a>
        <a href="profit-calculator.html" class="nav-pill px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-zinc-800 text-sm transition-colors" data-translate="nav.profit">Profit</a>
        <a href="mandi-locator.html" class="nav-pill px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-zinc-800 text-sm transition-colors" data-translate="nav.mandi">Mandi</a>
        <a href="profile.html" class="nav-pill px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-zinc-800 text-sm transition-colors" data-translate="nav.profile">Profile</a>
        <div class="lang-dropdown relative ml-auto sm:ml-0" id="lang-dropdown">
          <button type="button" id="lang-trigger" class="lang-trigger flex items-center gap-1.5 px-3 py-2.5 rounded-xl bg-white/90 dark:bg-slate-800/90 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-200 text-sm font-medium min-h-[44px]" aria-haspopup="listbox" aria-expanded="false">
            <span class="material-icons text-base">language</span>
            <span id="lang-current">English</span>
            <span class="material-icons text-slate-400 text-base">expand_more</span>
          </button>
          <div id="lang-panel" class="lang-panel absolute top-full right-0 mt-2 min-w-[160px] py-1.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl shadow-lg z-50 hidden" role="listbox">
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="en" role="option">English</button>
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="hi" role="option">हिंदी</button>
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="mr" role="option">मराठी</button>
          </div>
        </div>
        <button onclick="toggleTheme()" class="kd-tap kd-tap-feedback w-10 h-10 flex items-center justify-center rounded-xl text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 kd-transition" title="Toggle theme" aria-label="Toggle theme">
          <span class="material-icons text-xl">contrast</span>
        </button>
      </div>
    </div>
  </nav>
  <main class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-white" data-translate="market_prices.title">Market Prices by Mandi</h1>
      <p class="text-slate-500 dark:text-slate-400 mt-1" data-translate="market_prices.subtitle">Select your nearest mandi to see live commodity rates.</p>
    </header>
    <div class="bg-white dark:bg-slate-900/80 rounded-2xl p-5 border-2 border-slate-100 dark:border-slate-700/80 shadow-sm mb-6">
      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-2" data-translate="market_prices.select_mandi">Select Mandi</label>
      <select id="mandi-select" class="w-full px-4 py-3.5 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-slate-50/50 dark:bg-slate-800/50 focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-shadow">
        <option>Azadpur Mandi, New Delhi</option>
        <option>Nashik Mandi, Maharashtra</option>
        <option>Indore Mandi, Madhya Pradesh</option>
        <option>Pune APMC</option>
      </select>
    </div>
    <section class="space-y-4" id="prices-container">
      <!-- Crop cards rendered dynamically from getPriceData() -->
    </section>
  </main>

  <div class="fixed bottom-24 right-4 z-[60]">
    <button type="button" class="voice-mic-btn w-14 h-14 bg-primary text-white rounded-full flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all" aria-label="Voice assistant" onclick="typeof toggleVoiceRecognition==='function'&&toggleVoiceRecognition()">
      <span class="material-icons text-2xl">mic</span>
    </button>
  </div>

  <script>
    (function() {
      function renderPrices() {
        if (typeof incrementStat === 'function') incrementStat('pricesViewed');
        var container = document.getElementById('prices-container');
        if (!container) return;
        var data = typeof getPriceData === 'function' ? getPriceData() : (typeof cropData !== 'undefined' ? cropData : {});
        var lang = typeof currentLanguage !== 'undefined' ? currentLanguage : 'en';
        container.innerHTML = '';
        Object.entries(data).forEach(function(_ref) {
          var cropKey = _ref[0], cropInfo = _ref[1];
          var isUp = cropInfo.trendDirection === 'up';
          var trendCls = isUp ? 'bg-primary/10 text-primary' : 'bg-red-50 dark:bg-red-900/20 text-red-500 dark:text-red-400';
          var trendIcon = isUp ? 'trending_up' : 'trending_down';
          var name = cropInfo.name && (cropInfo.name[lang] || cropInfo.name.en) ? (cropInfo.name[lang] || cropInfo.name.en) : cropKey;
          var nameHi = cropInfo.name && cropInfo.name.hi ? cropInfo.name.hi : '';
          var price = typeof cropInfo.price === 'number' ? cropInfo.price : parseInt(cropInfo.price, 10) || 0;
          var trend = cropInfo.trend || (isUp ? '+0' : '-0');
          var card = document.createElement('div');
          card.className = 'card-hover bg-white dark:bg-slate-900/80 rounded-2xl p-5 border-2 border-slate-100 dark:border-slate-700/80 flex flex-wrap items-center justify-between gap-4 transition-all';
          card.innerHTML = '<div class="flex items-center gap-4"><div class="w-14 h-14 bg-primary/10 dark:bg-primary/20 rounded-xl flex items-center justify-center"><span class="material-icons text-2xl text-primary">eco</span></div><div><h3 class="text-lg font-bold text-slate-800 dark:text-white">' + name + (nameHi ? ' (' + nameHi + ')' : '') + '</h3><p class="text-2xl font-black text-primary">₹' + price.toLocaleString('en-IN') + ' <span class="text-sm font-normal text-slate-400">/quintal</span></p></div></div><span class="flex items-center gap-1 ' + trendCls + ' px-3 py-1.5 rounded-full font-bold text-sm"><span class="material-icons text-sm">' + trendIcon + '</span>' + trend + '</span>';
          container.appendChild(card);
        });
      }
      document.addEventListener('DOMContentLoaded', function() { setTimeout(renderPrices, 100); });
      window.addEventListener('storage', function(e) { if (e.key === 'kisan_drishti_prices') setTimeout(renderPrices, 50); });
      window.addEventListener('languagechange', function() { setTimeout(renderPrices, 50); });
    })();
  </script>
</body>
</html>
