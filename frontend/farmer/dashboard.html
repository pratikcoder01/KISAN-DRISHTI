<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Intelligence | KISAN-DRISHTI</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700&display=swap"
    rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link href="../css/style.css" rel="stylesheet" />
  <script src="../js/main.js"></script>
  <script src="../js/language-selector.js"></script>
  <script src="../js/voice-interaction.js"></script>
</head>

<body
  class="bg-background-light dark:bg-background-dark font-display min-h-screen pb-28 sm:pb-24 text-slate-800 dark:text-slate-100">
  <nav class="kd-glass sticky top-0 z-50 border-b border-slate-200/60 dark:border-slate-700/60 px-4 py-3">
    <div class="max-w-4xl mx-auto flex items-center justify-between flex-wrap gap-3">
      <a href="../index.html"
        class="flex items-center gap-3 text-slate-800 dark:text-white hover:text-primary kd-transition min-h-[44px] items-center">
        <img src="../images/spit%20logo.png" alt="KISAN-DRISHTI"
          class="h-10 w-10 object-contain flex-shrink-0 rounded-xl"
          onerror="this.style.display='none'; var n=this.nextElementSibling; if(n) n.classList.remove('hidden');" />
        <div
          class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white shadow-md shadow-primary/20 flex-shrink-0 hidden">
          <span class="material-icons">visibility</span>
        </div>
        <div>
          <span class="text-lg font-bold block leading-tight">KISAN-DRISHTI</span>
          <span class="text-[10px] uppercase tracking-wider text-primary font-semibold">Market Intelligence</span>
        </div>
      </a>
      <div class="flex items-center gap-2 flex-wrap">
        <a href="dashboard.html"
          class="nav-pill px-4 py-3 rounded-xl bg-primary/10 text-primary font-semibold text-sm min-h-[44px] inline-flex items-center">Dashboard</a>
        <a href="market-prices.html"
          class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center">Prices</a>
        <a href="profit-calculator.html"
          class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center">Profit</a>
        <a href="mandi-locator.html"
          class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center">Mandi</a>
        <a href="profile.html"
          class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center">Profile</a>
        <div class="lang-dropdown relative ml-auto" id="lang-dropdown">
          <button type="button" id="lang-trigger"
            class="lang-trigger flex items-center gap-1.5 px-3 py-2.5 rounded-xl bg-white/90 dark:bg-slate-800/90 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-200 text-sm font-medium"
            aria-haspopup="listbox" aria-expanded="false">
            <span class="material-icons text-base">language</span>
            <span id="lang-current">English</span>
            <span class="material-icons text-slate-400 text-base">expand_more</span>
          </button>
          <div id="lang-panel"
            class="lang-panel absolute top-full right-0 mt-2 min-w-[160px] py-1.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl shadow-lg z-50 hidden"
            role="listbox">
            <button type="button"
              class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors"
              data-lang="en" role="option">English</button>
            <button type="button"
              class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors"
              data-lang="hi" role="option">हिंदी</button>
            <button type="button"
              class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors"
              data-lang="mr" role="option">मराठी</button>
          </div>
        </div>
        <button onclick="toggleTheme()"
          class="kd-tap kd-tap-feedback w-10 h-10 flex items-center justify-center rounded-xl text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 kd-transition"
          title="Toggle theme" aria-label="Toggle theme">
          <span class="material-icons text-xl">contrast</span>
        </button>
      </div>
    </div>
  </nav>
  <main class="max-w-4xl mx-auto px-4 py-6 sm:py-8">
    <!-- All Crops Banner -->
    <div
      class="mb-8 rounded-2xl overflow-hidden shadow-lg relative h-48 sm:h-64 group bg-gradient-to-r from-green-700 to-emerald-900">
      <img src="../images/all_crops.png" alt="Varieties of Indian Crops"
        class="w-full h-full object-cover object-center transform group-hover:scale-105 transition-transform duration-700 mix-blend-overlay opacity-50"
        onerror="this.style.opacity='0'">
      <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent flex items-end p-6">
        <h3 class="text-white text-2xl font-bold drop-shadow-md">Fresh Harvests</h3>
      </div>
    </div>

    <header class="mb-8">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white mb-1 leading-tight"
            data-translate-html="dashboard.market_prices_title">Market Prices मंडी भाव</h2>
          <p class="text-slate-500 dark:text-slate-400 flex items-center gap-2 text-sm sm:text-base">
            <span class="material-icons text-primary text-lg">location_on</span>
            <span data-translate-html="dashboard.location_info">Azadpur Mandi, New Delhi · <span
                class="font-semibold text-slate-700 dark:text-slate-300">Today</span></span>
          </p>
        </div>
        <button onclick="speakAllPrices()"
          class="kd-tap-feedback bg-primary hover:bg-primary-hover text-white px-5 py-3 rounded-xl flex items-center gap-2 kd-transition shadow-lg shadow-primary/20 min-h-[44px]">
          <span class="material-icons">volume_up</span>
          <span class="text-sm font-medium" data-translate="dashboard.play_all">Play All Prices</span>
        </button>
      </div>
    </header>
    <section class="space-y-4" id="crops-container">
      <!-- Crops will be dynamically generated here -->
    </section>

    <script>
      // Generate all crop cards dynamically
      function generateCropCards() {
        const container = document.getElementById('crops-container');
        if (!container) return;
        if (typeof incrementStat === 'function') incrementStat('pricesViewed');
        container.innerHTML = '';

        const data = typeof getPriceData === 'function' ? getPriceData() : cropData;
        const lang = typeof currentLanguage !== 'undefined' ? currentLanguage : 'en';
        Object.entries(data).forEach(([cropKey, cropInfo]) => {
          const isUp = cropInfo.trendDirection === 'up';
          const trendIcon = isUp ? 'trending_up' : 'trending_down';
          const suggestionText = cropInfo.suggestion === 'sell_today' ? 'Sell Today' :
            cropInfo.suggestion === 'wait_2_days' ? 'Wait 2 Days' :
              cropInfo.suggestion === 'wait_3_days' ? 'Wait 3 Days' : 'Hold';
          const textCls = isUp ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400';
          const bgCls = isUp ? 'bg-green-100 dark:bg-green-900/30' : 'bg-red-100 dark:bg-red-900/30';
          const bgCls2 = isUp ? 'bg-green-50 dark:bg-green-900/20' : 'bg-red-50 dark:bg-red-900/20';
          const bgCls3 = isUp ? 'bg-green-500/10' : 'bg-red-500/10';
          const nameLang = cropInfo.name && (cropInfo.name[lang] || cropInfo.name.en) ? (cropInfo.name[lang] || cropInfo.name.en) : cropInfo.name.en;
          const nameOther = lang === 'en' ? (cropInfo.name.hi || '') : (cropInfo.name.en || '');
          const card = document.createElement('article');
          card.className = 'price-card kd-glass-card rounded-2xl p-5 sm:p-6 border border-slate-200 dark:border-slate-700';

          card.innerHTML = `
            <div class="flex flex-wrap items-center justify-between gap-4">
              <div class="flex items-center gap-5">
                <div class="w-12 h-12 rounded-xl bg-primary/10 dark:bg-primary/20 flex items-center justify-center flex-shrink-0">
                  <span class="material-icons text-2xl text-primary">eco</span>
                </div>
                <div>
                  <h3 class="text-xl sm:text-2xl font-bold text-slate-800 dark:text-white">
                    ${nameLang} ${nameOther ? '<span class="font-normal text-slate-500 dark:text-slate-400">' + nameOther + '</span>' : ''}
                  </h3>
                  <p class="text-2xl sm:text-3xl font-bold mt-0.5 ${textCls}">
                    ₹${cropInfo.price} <span class="text-base font-medium text-slate-400">/quintal</span>
                  </p>
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                <div class="${bgCls} px-3 py-2 rounded-xl flex items-center gap-2">
                  <span class="material-icons text-xl ${textCls}">${trendIcon}</span>
                  <span class="font-bold text-lg ${textCls}">${cropInfo.trend}</span>
                </div>
                <div class="${bgCls2} px-3 py-1.5 rounded-full">
                  <p class="text-xs font-bold ${textCls}">7-day: ${isUp ? 'Rising' : 'Falling'}</p>
                </div>
                <div class="${bgCls3} px-3 py-1.5 rounded-full">
                  <p class="text-xs font-bold ${textCls}">${suggestionText}</p>
                </div>
                <button type="button" onclick="speakPrice('${cropKey}', ${cropInfo.price}, '${cropInfo.trend}')" class="bg-primary hover:bg-primary-hover text-white p-2 rounded-lg transition-colors">
                  <span class="material-icons">volume_up</span>
                </button>
              </div>
            </div>
          `;

          container.appendChild(card);
        });
      }

      // Generate cards when page loads
      document.addEventListener('DOMContentLoaded', function () {
        setTimeout(generateCropCards, 100);
      });
      // PS: instant sync — when official updates prices (other tab), re-render
      window.addEventListener('storage', function (e) {
        if (e.key === 'kisan_drishti_prices') setTimeout(generateCropCards, 50);
      });

      // Regenerate cards when language changes
      const originalSetLanguage = window.setLanguage;
      window.setLanguage = function (lang) {
        originalSetLanguage(lang);
        setTimeout(generateCropCards, 50);
      };
    </script>
    <section class="mt-10 grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div class="bg-primary/5 dark:bg-primary/10 border border-primary/20 rounded-2xl p-5 sm:p-6">
        <h4 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2">
          <span class="material-icons text-primary">wb_sunny</span>Weather
        </h4>
        <div class="flex items-center justify-between">
          <div>
            <p class="text-3xl font-bold text-slate-900 dark:text-white">32°C</p>
            <p class="text-sm text-slate-600 dark:text-slate-400">Clear · Delhi</p>
          </div>
          <div class="text-right">
            <p class="text-sm font-semibold text-primary">Optimal Sowing</p>
            <p class="text-xs text-slate-400">Humidity 45%</p>
          </div>
        </div>
      </div>
      <div class="bg-white dark:bg-zinc-800/50 border border-slate-200 dark:border-zinc-700 rounded-2xl p-5 sm:p-6">
        <h4 class="text-lg font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2"
          data-translate="dashboard.alerts">
          <span class="material-icons text-slate-500">notifications</span>Alerts
        </h4>
        <ul class="space-y-2 text-sm text-slate-600 dark:text-slate-300">
          <li class="border-l-2 border-primary pl-3">New MSP for Rabi 2024-25</li>
          <li class="border-l-2 border-primary pl-3">Subsidized seeds at District Center</li>
        </ul>
      </div>
    </section>
  </main>
  <div class="fixed bottom-24 sm:bottom-20 left-0 right-0 z-[60] pointer-events-none">
    <div class="text-center">
      <span
        class="bg-slate-800/90 text-white text-xs px-4 py-2 rounded-full font-medium shadow-lg inline-block mb-2 backdrop-blur-sm"
        data-translate="dashboard.voice_tooltip">बोलने के लिए
        दबाएं · Click to speak</span>
      <button type="button"
        class="voice-mic-btn w-16 h-16 sm:w-20 sm:h-20 bg-primary text-white rounded-full flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all duration-200 pulse-mic focus:outline-none focus:ring-4 focus:ring-primary/30 border-4 border-white dark:border-slate-800 mx-auto pointer-events-auto"
        aria-label="Voice assistant" onclick="typeof toggleVoiceRecognition === 'function' && toggleVoiceRecognition()">
        <span class="material-icons text-3xl">mic</span>
      </button>
    </div>
  </div>
  <nav
    class="bottom-nav fixed bottom-0 left-0 right-0 z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-md border-t border-slate-200/80 dark:border-slate-700/80 px-4 py-3 safe-area-pb">
    <div class="max-w-3xl mx-auto flex justify-between items-center">
      <a href="market-prices.html"
        class="flex flex-col items-center gap-1 min-w-[64px] py-1 text-slate-400 font-medium hover:text-primary transition-colors">
        <span class="material-icons text-2xl">analytics</span>
        <span class="text-[10px] uppercase tracking-wider" data-translate="nav.prices">Prices</span>
      </a>
      <a href="profit-calculator.html"
        class="flex flex-col items-center gap-1 min-w-[64px] py-1 text-slate-400 font-medium hover:text-primary transition-colors">
        <span class="material-icons text-2xl">calculate</span>
        <span class="text-[10px] uppercase tracking-wider" data-translate="nav.profit">Profit</span>
      </a>
      <a href="mandi-locator.html"
        class="flex flex-col items-center gap-1 min-w-[64px] py-1 text-slate-400 font-medium hover:text-primary transition-colors">
        <span class="material-icons text-2xl">location_on</span>
        <span class="text-[10px] uppercase tracking-wider" data-translate="nav.mandi">Mandi</span>
      </a>
      <a href="profile.html"
        class="flex flex-col items-center gap-1 min-w-[64px] py-1 text-slate-400 font-medium hover:text-primary transition-colors">
        <span class="material-icons text-2xl">person</span>
        <span class="text-[10px] uppercase tracking-wider" data-translate="nav.profile">Profile</span>
      </a>
    </div>
  </nav>
</body>

</html>