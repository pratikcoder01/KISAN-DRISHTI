<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile | KISAN-DRISHTI</title>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="../css/style.css" rel="stylesheet" />
  <script src="../js/main.js"></script>
  <script src="../js/language-selector.js"></script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-100 min-h-screen">
  <nav class="kd-glass sticky top-0 z-50 border-b border-slate-200/60 dark:border-slate-700/60 px-4 py-3">
    <div class="max-w-4xl mx-auto flex items-center justify-between flex-wrap gap-2">
      <a href="../index.html" class="flex items-center gap-3 text-slate-800 dark:text-white hover:text-primary kd-transition min-h-[44px] items-center">
        <img src="../images/spit%20logo.png" alt="KISAN-DRISHTI" class="h-10 w-10 object-contain flex-shrink-0 rounded-xl" onerror="this.style.display='none'; var n=this.nextElementSibling; if(n) n.classList.remove('hidden');" />
        <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white shadow-md flex-shrink-0 hidden"><span class="material-icons">visibility</span></div>
        <span class="text-lg font-bold">KISAN-DRISHTI</span>
      </a>
      <div class="flex items-center gap-2 flex-wrap">
        <a href="dashboard.html" class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center" data-translate="nav.dashboard">Dashboard</a>
        <a href="market-prices.html" class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center" data-translate="nav.prices">Prices</a>
        <a href="profit-calculator.html" class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center" data-translate="nav.profit">Profit</a>
        <a href="mandi-locator.html" class="nav-pill px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 text-sm kd-transition min-h-[44px] inline-flex items-center" data-translate="nav.mandi">Mandi</a>
        <a href="profile.html" class="px-4 py-3 rounded-xl bg-primary/10 text-primary font-semibold text-sm min-h-[44px] inline-flex items-center" data-translate="nav.profile">Profile</a>
        <div class="lang-dropdown relative ml-auto sm:ml-0" id="lang-dropdown">
          <button type="button" id="lang-trigger" class="lang-trigger flex items-center gap-1.5 px-3 py-2.5 rounded-xl bg-white/90 dark:bg-slate-800/90 border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-200 text-sm font-medium min-h-[44px]" aria-haspopup="listbox" aria-expanded="false">
            <span class="material-icons text-base">language</span>
            <span id="lang-current">English</span>
            <span class="material-icons text-slate-400 text-base">expand_more</span>
          </button>
          <div id="lang-panel" class="lang-panel absolute top-full right-0 mt-2 min-w-[160px] py-1.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl shadow-lg z-50 hidden" role="listbox">
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="en" role="option">English</button>
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="hi" role="option">हिंदी</button>
            <button type="button" class="lang-option w-full text-left px-4 py-2.5 rounded-lg mx-1.5 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-primary/10 hover:text-primary transition-colors" data-lang="mr" role="option">मराठी</button>
          </div>
        </div>
        <button onclick="toggleTheme()" class="kd-tap kd-tap-feedback w-10 h-10 flex items-center justify-center rounded-xl text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 kd-transition" title="Toggle theme" aria-label="Toggle theme"><span class="material-icons text-xl">contrast</span></button>
      </div>
    </div>
  </nav>

  <main class="max-w-2xl mx-auto px-4 py-8">
    <!-- Profile header -->
    <div class="kd-glass-card rounded-2xl p-6 sm:p-8 mb-6">
      <div class="flex flex-wrap items-center gap-6">
        <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-2xl bg-primary/20 flex items-center justify-center text-primary flex-shrink-0">
          <span class="material-icons text-5xl sm:text-6xl">account_circle</span>
        </div>
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold text-slate-900 dark:text-white" id="profileGreeting" data-translate="profile.welcome">Welcome back!</h1>
          <p class="text-slate-500 dark:text-slate-400 mt-1" data-translate="profile.manage_desc">Manage your profile and preferences.</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex gap-2 mb-6 border-b border-slate-200 dark:border-slate-700">
      <button type="button" id="tabPersonal" class="profile-tab px-4 py-3 rounded-t-xl font-semibold text-sm border-b-2 border-primary text-primary bg-primary/5" data-tab="personal" data-translate="profile.personal">Personal</button>
      <button type="button" id="tabFarm" class="profile-tab px-4 py-3 rounded-t-xl font-semibold text-sm border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300" data-tab="farm" data-translate="profile.farm">Farm</button>
      <button type="button" id="tabPreferences" class="profile-tab px-4 py-3 rounded-t-xl font-semibold text-sm border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:hover:text-slate-300" data-tab="preferences" data-translate="profile.preferences">Preferences</button>
    </div>

    <!-- Section: Personal -->
    <section id="sectionPersonal" class="profile-section kd-glass-card rounded-2xl p-6 sm:p-8 space-y-5">
      <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2"><span class="material-icons text-primary">person</span><span data-translate="profile.personal_details">Personal details</span></h2>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profileName" data-translate="profile.full_name">Full name</label>
        <input id="profileName" type="text" placeholder="e.g. Ramesh Kumar" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white" />
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profilePhone" data-translate="profile.phone">Phone (optional)</label>
        <input id="profilePhone" type="tel" placeholder="e.g. 98765 43210" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white" />
      </div>
    </section>

    <!-- Section: Farm -->
    <section id="sectionFarm" class="profile-section hidden kd-glass-card rounded-2xl p-6 sm:p-8 space-y-5">
      <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2"><span class="material-icons text-primary">grass</span><span data-translate="profile.farm_location">Farm & location</span></h2>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profileDistrict" data-translate="profile.district">District</label>
        <select id="profileDistrict" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white">
          <option value="" data-translate="profile.select_district">Select district</option>
          <option value="Karnal, Haryana">Karnal, Haryana</option>
          <option value="Nashik, Maharashtra">Nashik, Maharashtra</option>
          <option value="Indore, Madhya Pradesh">Indore, Madhya Pradesh</option>
          <option value="Chandigarh">Chandigarh</option>
          <option value="Pune, Maharashtra">Pune, Maharashtra</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profileVillage" data-translate="profile.village">Village / area (optional)</label>
        <input id="profileVillage" type="text" placeholder="e.g. Rampura" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white" />
      </div>
    </section>

    <!-- Section: Preferences -->
    <section id="sectionPreferences" class="profile-section hidden kd-glass-card rounded-2xl p-6 sm:p-8 space-y-5">
      <h2 class="text-lg font-bold text-slate-900 dark:text-white flex items-center gap-2"><span class="material-icons text-primary">tune</span><span data-translate="profile.preferences">Preferences</span></h2>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profileLanguage" data-translate="profile.preferred_language">Preferred language</label>
        <select id="profileLanguage" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white">
          <option value="en">English</option>
          <option value="hi">हिंदी</option>
          <option value="mr">मराठी</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-200 mb-1" for="profileCrop" data-translate="profile.primary_crop">Primary crop you grow</label>
        <select id="profileCrop" class="input-focus w-full px-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-800 dark:text-white">
          <option value="Wheat">Wheat (गेहूं)</option>
          <option value="Rice">Rice (चावल)</option>
          <option value="Onion">Onion (प्याज)</option>
          <option value="Tomato">Tomato (टमाटर)</option>
          <option value="Cotton">Cotton (कपास)</option>
          <option value="Pulses">Pulses (दाल)</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <p class="text-sm text-slate-500 dark:text-slate-400" data-translate="profile.lang_note">Language here updates the app language when you save.</p>
    </section>

    <!-- Activity summary -->
    <div class="kd-glass-card rounded-2xl p-6 mt-6">
      <h2 class="text-lg font-bold text-slate-900 dark:text-white mb-4 flex items-center gap-2"><span class="material-icons text-primary">insights</span><span data-translate="profile.your_activity">Your activity</span></h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 text-center">
          <p id="statPrices" class="text-2xl font-bold text-primary">0</p>
          <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider" data-translate="profile.prices_viewed">Prices viewed</p>
        </div>
        <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 text-center">
          <p id="statMandis" class="text-2xl font-bold text-primary">0</p>
          <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider" data-translate="profile.mandis_saved">Mandis saved</p>
        </div>
        <div class="bg-slate-50 dark:bg-slate-800/50 rounded-xl p-4 text-center col-span-2 sm:col-span-1">
          <p id="statCalculations" class="text-2xl font-bold text-primary">0</p>
          <p class="text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider" data-translate="profile.profit_checks">Profit checks</p>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex flex-wrap gap-4 mt-8">
      <button type="button" id="profileSave" class="flex items-center gap-2 px-6 py-3 bg-primary text-white font-semibold rounded-xl hover:bg-primary-hover shadow-lg shadow-primary/20 transition-colors">
        <span class="material-icons">check_circle</span><span data-translate="profile.save_profile">Save profile</span>
      </button>
      <a href="../index.html" class="flex items-center gap-2 px-6 py-3 border-2 border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-400 font-semibold rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
        <span class="material-icons">logout</span><span data-translate="profile.exit_home">Exit to home</span>
      </a>
    </div>
  </main>

  <script>
(function() {
  var STORAGE_KEY = 'kisan_drishti_profile';
  var STATS_KEY = 'kisan_drishti_stats';

  function getProfile() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    } catch (e) { return {}; }
  }
  function saveProfile(obj) {
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); } catch (e) {}
  }
  function getStats() {
    try {
      return JSON.parse(localStorage.getItem(STATS_KEY) || '{}');
    } catch (e) { return {}; }
  }

  function loadProfile() {
    var p = getProfile();
    document.getElementById('profileName').value = p.name || '';
    document.getElementById('profilePhone').value = p.phone || '';
    document.getElementById('profileDistrict').value = p.district || '';
    document.getElementById('profileVillage').value = p.village || '';
    document.getElementById('profileLanguage').value = p.language || 'en';
    document.getElementById('profileCrop').value = p.crop || 'Wheat';
    var name = (p.name || '').trim() || 'Farmer';
    document.getElementById('profileGreeting').textContent = (typeof getTranslation === 'function' ? getTranslation('profile.welcome_name', { name: name }) : 'Welcome back, ' + name + '!');
  }
  function loadStats() {
    var s = getStats();
    document.getElementById('statPrices').textContent = s.pricesViewed || 0;
    document.getElementById('statMandis').textContent = s.mandisSaved || 0;
    document.getElementById('statCalculations').textContent = s.profitChecks || 0;
  }

  document.getElementById('profileSave').addEventListener('click', function() {
    var name = (document.getElementById('profileName').value || '').trim();
    var profile = {
      name: name,
      phone: (document.getElementById('profilePhone').value || '').trim(),
      district: document.getElementById('profileDistrict').value || '',
      village: (document.getElementById('profileVillage').value || '').trim(),
      language: document.getElementById('profileLanguage').value || 'en',
      crop: document.getElementById('profileCrop').value || 'Wheat'
    };
    saveProfile(profile);
    document.getElementById('profileGreeting').textContent = (typeof getTranslation === 'function' ? getTranslation('profile.welcome_name', { name: name || 'Farmer' }) : 'Welcome back, ' + (name || 'Farmer') + '!');
    if (typeof setLanguage === 'function') setLanguage(profile.language);
    alert(typeof getTranslation === 'function' ? getTranslation('profile.saved') : 'Profile saved.');
  });

  document.querySelectorAll('.profile-tab').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var tab = this.getAttribute('data-tab');
      document.querySelectorAll('.profile-tab').forEach(function(b) {
        b.classList.remove('border-primary', 'text-primary', 'bg-primary/5');
        b.classList.add('border-transparent', 'text-slate-500');
      });
      this.classList.add('border-primary', 'text-primary', 'bg-primary/5');
      this.classList.remove('border-transparent', 'text-slate-500');
      document.querySelectorAll('.profile-section').forEach(function(s) { s.classList.add('hidden'); });
      var section = document.getElementById('section' + tab.charAt(0).toUpperCase() + tab.slice(1));
      if (section) section.classList.remove('hidden');
    });
  });

  loadProfile();
  loadStats();
})();
  </script>
</body>
</html>
